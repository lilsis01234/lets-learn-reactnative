{"ast":null,"code":"import _asyncToGenerator from \"@babel/runtime/helpers/asyncToGenerator\";\nimport _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nimport React, { useEffect, useState, useRef } from 'react';\nimport View from \"react-native-web/dist/exports/View\";\nimport Text from \"react-native-web/dist/exports/Text\";\nimport Button from \"react-native-web/dist/exports/Button\";\nimport { Camera } from 'expo-camera';\nimport { Video } from 'expo-av';\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nvar AppointmentsScreen = function AppointmentsScreen(_ref) {\n  var _ref3;\n  var route = _ref.route;\n  var _useState = useState([]),\n    _useState2 = _slicedToArray(_useState, 2),\n    docteur = _useState2[0],\n    setDocteur = _useState2[1];\n  useEffect(function () {\n    var doctorId = route.params.doctorId;\n    axios.get(`http://localhost:3000/doctor/profil/${doctorId}`).then(function (response) {\n      setDocteur(response.data);\n    }).catch(function (error) {\n      console.error(error);\n    });\n  }, [route.params]);\n  var _useState3 = useState(null),\n    _useState4 = _slicedToArray(_useState3, 2),\n    localStream = _useState4[0],\n    setLocalStream = _useState4[1];\n  var _useState5 = useState(null),\n    _useState6 = _slicedToArray(_useState5, 2),\n    remoteStream = _useState6[0],\n    setRemoteStream = _useState6[1];\n  var _useState7 = useState(false),\n    _useState8 = _slicedToArray(_useState7, 2),\n    isCalling = _useState8[0],\n    setIsCalling = _useState8[1];\n  var peerConnectionRef = useRef(null);\n  useEffect(function () {\n    var _ref2;\n    var getCameraPermission = function getCameraPermission() {\n      return (_ref2 = _ref2 || _asyncToGenerator(function* () {\n        var _yield$Camera$request = yield Camera.requestPermissionsAsync(),\n          status = _yield$Camera$request.status;\n        if (status === 'granted') {\n          var stream = yield Camera.getCameraStreamAsync({\n            type: Camera.Constants.Type.front,\n            audio: true\n          });\n          setLocalStream(stream);\n        }\n      })).apply(this, arguments);\n    };\n    getCameraPermission();\n  }, []);\n  var startVideoCall = function startVideoCall() {\n    return (_ref3 = _ref3 || _asyncToGenerator(function* () {\n      if (!localStream) {\n        console.log(\"Permission not granted for camera\");\n        return;\n      }\n      setIsCalling(true);\n      var configuration = {\n        iceServers: [{\n          urls: 'stun:stun.l.google.com:19302'\n        }]\n      };\n      var peerConnection = new RTCPeerConnection(configuration);\n      peerConnectionRef.current = peerConnection;\n      localStream.getTracks().forEach(function (track) {\n        peerConnection.addTrack(track, localStream);\n      });\n      peerConnection.onicecandidate = function (event) {\n        if (event.candidate) {}\n      };\n      peerConnection.onaddstream = function (event) {\n        var remoteVideoStream = event.stream;\n        setRemoteStream(remoteVideoStream);\n      };\n      var offer = yield peerConnection.createOffer();\n      yield peerConnection.setLocalDescription(offer);\n    })).apply(this, arguments);\n  };\n  var endVideoCall = function endVideoCall() {\n    if (peerConnectionRef.current) {\n      peerConnectionRef.current.close();\n      peerConnectionRef.current = null;\n    }\n    setIsCalling(false);\n    setRemoteStream(null);\n  };\n  return _jsxs(View, {\n    children: [_jsxs(Text, {\n      children: [\"Appel vid\\xE9o avec le m\\xE9decin \", docteur.name]\n    }), _jsx(View, {\n      children: localStream && _jsx(Camera, {\n        style: {\n          width: 200,\n          height: 200\n        },\n        type: Camera.Constants.Type.front,\n        ref: function ref(_ref4) {}\n      })\n    }), _jsx(View, {\n      children: remoteStream && _jsx(Video, {\n        source: {\n          uri: remoteStream.toURL()\n        },\n        style: {\n          width: 200,\n          height: 200\n        }\n      })\n    }), isCalling ? _jsx(Button, {\n      title: \"Terminer l'appel\",\n      onPress: endVideoCall\n    }) : _jsx(Button, {\n      title: \"Appeler maintenant\",\n      onPress: startVideoCall\n    })]\n  });\n};\nexport default AppointmentsScreen;","map":{"version":3,"names":["React","useEffect","useState","useRef","View","Text","Button","Camera","Video","jsxs","_jsxs","jsx","_jsx","AppointmentsScreen","_ref","_ref3","route","_useState","_useState2","_slicedToArray","docteur","setDocteur","doctorId","params","axios","get","then","response","data","catch","error","console","_useState3","_useState4","localStream","setLocalStream","_useState5","_useState6","remoteStream","setRemoteStream","_useState7","_useState8","isCalling","setIsCalling","peerConnectionRef","_ref2","getCameraPermission","_asyncToGenerator","_yield$Camera$request","requestPermissionsAsync","status","stream","getCameraStreamAsync","type","Constants","Type","front","audio","apply","arguments","startVideoCall","log","configuration","iceServers","urls","peerConnection","RTCPeerConnection","current","getTracks","forEach","track","addTrack","onicecandidate","event","candidate","onaddstream","remoteVideoStream","offer","createOffer","setLocalDescription","endVideoCall","close","children","name","style","width","height","ref","source","uri","toURL","title","onPress"],"sources":["C:/Users/Fabiola/Desktop/projet/front/components/VisioConference/VisioConference.jsx"],"sourcesContent":["import React, { useEffect, useState, useRef } from 'react';\r\nimport { View, Text, Button } from 'react-native';\r\nimport { Camera } from 'expo-camera';\r\nimport { Video } from 'expo-av';\r\n\r\nconst AppointmentsScreen = ({ route }) => {\r\n  const [docteur,setDocteur]= useState([]);\r\n\r\n  useEffect(() => {\r\n    const { doctorId } = route.params;\r\n\r\n    // Make a GET request to fetch user data based on doctorId\r\n    axios.get(`http://localhost:3000/doctor/profil/${doctorId}`)\r\n      .then((response) => {\r\n        // Set the fetched user data to the state\r\n        setDocteur(response.data);\r\n      })\r\n      .catch((error) => {\r\n        // Handle errors appropriately\r\n        console.error(error);\r\n      });\r\n  }, [route.params]);\r\n\r\n\r\n  const [localStream, setLocalStream] = useState(null);\r\n  const [remoteStream, setRemoteStream] = useState(null);\r\n  const [isCalling, setIsCalling] = useState(false);\r\n\r\n  const peerConnectionRef = useRef(null);\r\n\r\n  useEffect(() => {\r\n    // Gérez l'accès à la caméra ici avec Expo Camera (localStream)\r\n    const getCameraPermission = async () => {\r\n      const { status } = await Camera.requestPermissionsAsync();\r\n      if (status === 'granted') {\r\n        const stream = await Camera.getCameraStreamAsync({\r\n          type: Camera.Constants.Type.front,\r\n          audio: true, // You can include audio if needed\r\n        });\r\n        setLocalStream(stream);\r\n      }\r\n    };\r\n\r\n    getCameraPermission();\r\n  }, []);\r\n\r\n  const startVideoCall = async () => {\r\n    if (!localStream) {\r\n      console.log(\"Permission not granted for camera\");\r\n      return;\r\n    }\r\n\r\n    setIsCalling(true);\r\n\r\n    // Initialize and manage the peer-to-peer connection here\r\n    const configuration = { iceServers: [{ urls: 'stun:stun.l.google.com:19302' }] };\r\n    const peerConnection = new RTCPeerConnection(configuration);\r\n\r\n    peerConnectionRef.current = peerConnection;\r\n\r\n    localStream.getTracks().forEach((track) => {\r\n      peerConnection.addTrack(track, localStream);\r\n    });\r\n\r\n    peerConnection.onicecandidate = (event) => {\r\n      if (event.candidate) {\r\n        // Send the ICE candidate to the other participant\r\n        // You need a signaling server to exchange ICE candidates\r\n      }\r\n    };\r\n\r\n    peerConnection.onaddstream = (event) => {\r\n      const remoteVideoStream = event.stream;\r\n      setRemoteStream(remoteVideoStream);\r\n    };\r\n\r\n    // Create and send an offer to the other participant\r\n    const offer = await peerConnection.createOffer();\r\n    await peerConnection.setLocalDescription(offer);\r\n\r\n    // Send the offer to the other participant\r\n    // You need a signaling server to exchange offers and answers\r\n  };\r\n\r\n  const endVideoCall = () => {\r\n    // Terminate the video call and close the peer connection\r\n    if (peerConnectionRef.current) {\r\n      peerConnectionRef.current.close();\r\n      peerConnectionRef.current = null;\r\n    }\r\n    setIsCalling(false);\r\n    setRemoteStream(null);\r\n  };\r\n\r\n  return (\r\n    <View>\r\n      <Text>Appel vidéo avec le médecin {docteur.name}</Text>\r\n      <View>\r\n        {localStream && (\r\n          <Camera\r\n            style={{ width: 200, height: 200 }}\r\n            type={Camera.Constants.Type.front}\r\n            ref={(ref) => {\r\n              // You can access the camera component's ref here if needed\r\n            }}\r\n          />\r\n        )}\r\n      </View>\r\n      <View>\r\n        {remoteStream && <Video source={{ uri: remoteStream.toURL() }} style={{ width: 200, height: 200 }} />}\r\n      </View>\r\n      {isCalling ? (\r\n        <Button title=\"Terminer l'appel\" onPress={endVideoCall} />\r\n      ) : (\r\n        <Button title=\"Appeler maintenant\" onPress={startVideoCall} />\r\n      )}\r\n    </View>\r\n  );\r\n};\r\n\r\nexport default AppointmentsScreen;\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}