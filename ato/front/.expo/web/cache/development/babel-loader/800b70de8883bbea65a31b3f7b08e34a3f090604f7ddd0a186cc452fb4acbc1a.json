{"ast":null,"code":"import _asyncToGenerator from \"@babel/runtime/helpers/asyncToGenerator\";\nimport _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nimport React, { useEffect, useState, useRef } from 'react';\nimport View from \"react-native-web/dist/exports/View\";\nimport Text from \"react-native-web/dist/exports/Text\";\nimport Button from \"react-native-web/dist/exports/Button\";\nimport { Camera } from 'expo-camera';\nimport { Video } from 'expo-av';\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nvar AppointmentsScreen = function AppointmentsScreen(_ref) {\n  var _ref3;\n  var route = _ref.route;\n  var doctorId = route.params.doctorId;\n  var _useState = useState(null),\n    _useState2 = _slicedToArray(_useState, 2),\n    localStream = _useState2[0],\n    setLocalStream = _useState2[1];\n  var _useState3 = useState(null),\n    _useState4 = _slicedToArray(_useState3, 2),\n    remoteStream = _useState4[0],\n    setRemoteStream = _useState4[1];\n  var _useState5 = useState(false),\n    _useState6 = _slicedToArray(_useState5, 2),\n    isCalling = _useState6[0],\n    setIsCalling = _useState6[1];\n  var peerConnectionRef = useRef(null);\n  useEffect(function () {\n    var _ref2;\n    var getCameraPermission = function getCameraPermission() {\n      return (_ref2 = _ref2 || _asyncToGenerator(function* () {\n        var _yield$Camera$request = yield Camera.requestPermissionsAsync(),\n          status = _yield$Camera$request.status;\n        if (status === 'granted') {\n          var stream = yield Camera.getCameraStreamAsync({\n            type: Camera.Constants.Type.front,\n            audio: true\n          });\n          setLocalStream(stream);\n        }\n      })).apply(this, arguments);\n    };\n    getCameraPermission();\n  }, []);\n  var startVideoCall = function startVideoCall() {\n    return (_ref3 = _ref3 || _asyncToGenerator(function* () {\n      if (!localStream) {\n        console.log(\"Permission not granted for camera\");\n        return;\n      }\n      setIsCalling(true);\n      var configuration = {\n        iceServers: [{\n          urls: 'stun:stun.l.google.com:19302'\n        }]\n      };\n      var peerConnection = new RTCPeerConnection(configuration);\n      peerConnectionRef.current = peerConnection;\n      localStream.getTracks().forEach(function (track) {\n        peerConnection.addTrack(track, localStream);\n      });\n      peerConnection.onicecandidate = function (event) {\n        if (event.candidate) {}\n      };\n      peerConnection.onaddstream = function (event) {\n        var remoteVideoStream = event.stream;\n        setRemoteStream(remoteVideoStream);\n      };\n      var offer = yield peerConnection.createOffer();\n      yield peerConnection.setLocalDescription(offer);\n    })).apply(this, arguments);\n  };\n  var endVideoCall = function endVideoCall() {\n    if (peerConnectionRef.current) {\n      peerConnectionRef.current.close();\n      peerConnectionRef.current = null;\n    }\n    setIsCalling(false);\n    setRemoteStream(null);\n  };\n  return _jsxs(View, {\n    children: [_jsxs(Text, {\n      children: [\"Appel vid\\xE9o avec le m\\xE9decin \", doctorId]\n    }), _jsx(View, {\n      children: localStream && _jsx(Camera, {\n        style: {\n          width: 200,\n          height: 200\n        },\n        type: Camera.Constants.Type.front,\n        ref: function ref(_ref4) {}\n      })\n    }), _jsx(View, {\n      children: remoteStream && _jsx(Video, {\n        source: {\n          uri: remoteStream.toURL()\n        },\n        style: {\n          width: 200,\n          height: 200\n        }\n      })\n    }), isCalling ? _jsx(Button, {\n      title: \"Terminer l'appel\",\n      onPress: endVideoCall\n    }) : _jsx(Button, {\n      title: \"Appeler maintenant\",\n      onPress: startVideoCall\n    })]\n  });\n};\nexport default AppointmentsScreen;","map":{"version":3,"names":["React","useEffect","useState","useRef","View","Text","Button","Camera","Video","jsxs","_jsxs","jsx","_jsx","AppointmentsScreen","_ref","_ref3","route","doctorId","params","_useState","_useState2","_slicedToArray","localStream","setLocalStream","_useState3","_useState4","remoteStream","setRemoteStream","_useState5","_useState6","isCalling","setIsCalling","peerConnectionRef","_ref2","getCameraPermission","_asyncToGenerator","_yield$Camera$request","requestPermissionsAsync","status","stream","getCameraStreamAsync","type","Constants","Type","front","audio","apply","arguments","startVideoCall","console","log","configuration","iceServers","urls","peerConnection","RTCPeerConnection","current","getTracks","forEach","track","addTrack","onicecandidate","event","candidate","onaddstream","remoteVideoStream","offer","createOffer","setLocalDescription","endVideoCall","close","children","style","width","height","ref","source","uri","toURL","title","onPress"],"sources":["C:/Users/Fabiola/Desktop/projet/front/components/VisioConference/VisioConference.jsx"],"sourcesContent":["import React, { useEffect, useState, useRef } from 'react';\r\nimport { View, Text, Button } from 'react-native';\r\nimport { Camera } from 'expo-camera';\r\nimport { Video } from 'expo-av';\r\n\r\nconst AppointmentsScreen = ({ route }) => {\r\n  const { doctorId } = route.params;\r\n\r\n  const [localStream, setLocalStream] = useState(null);\r\n  const [remoteStream, setRemoteStream] = useState(null);\r\n  const [isCalling, setIsCalling] = useState(false);\r\n\r\n  const peerConnectionRef = useRef(null);\r\n\r\n  useEffect(() => {\r\n    // Gérez l'accès à la caméra ici avec Expo Camera (localStream)\r\n    const getCameraPermission = async () => {\r\n      const { status } = await Camera.requestPermissionsAsync();\r\n      if (status === 'granted') {\r\n        const stream = await Camera.getCameraStreamAsync({\r\n          type: Camera.Constants.Type.front,\r\n          audio: true, // You can include audio if needed\r\n        });\r\n        setLocalStream(stream);\r\n      }\r\n    };\r\n\r\n    getCameraPermission();\r\n  }, []);\r\n\r\n  const startVideoCall = async () => {\r\n    if (!localStream) {\r\n      console.log(\"Permission not granted for camera\");\r\n      return;\r\n    }\r\n\r\n    setIsCalling(true);\r\n\r\n    // Initialize and manage the peer-to-peer connection here\r\n    const configuration = { iceServers: [{ urls: 'stun:stun.l.google.com:19302' }] };\r\n    const peerConnection = new RTCPeerConnection(configuration);\r\n\r\n    peerConnectionRef.current = peerConnection;\r\n\r\n    localStream.getTracks().forEach((track) => {\r\n      peerConnection.addTrack(track, localStream);\r\n    });\r\n\r\n    peerConnection.onicecandidate = (event) => {\r\n      if (event.candidate) {\r\n        // Send the ICE candidate to the other participant\r\n        // You need a signaling server to exchange ICE candidates\r\n      }\r\n    };\r\n\r\n    peerConnection.onaddstream = (event) => {\r\n      const remoteVideoStream = event.stream;\r\n      setRemoteStream(remoteVideoStream);\r\n    };\r\n\r\n    // Create and send an offer to the other participant\r\n    const offer = await peerConnection.createOffer();\r\n    await peerConnection.setLocalDescription(offer);\r\n\r\n    // Send the offer to the other participant\r\n    // You need a signaling server to exchange offers and answers\r\n  };\r\n\r\n  const endVideoCall = () => {\r\n    // Terminate the video call and close the peer connection\r\n    if (peerConnectionRef.current) {\r\n      peerConnectionRef.current.close();\r\n      peerConnectionRef.current = null;\r\n    }\r\n    setIsCalling(false);\r\n    setRemoteStream(null);\r\n  };\r\n\r\n  return (\r\n    <View>\r\n      <Text>Appel vidéo avec le médecin {doctorId}</Text>\r\n      <View>\r\n        {localStream && (\r\n          <Camera\r\n            style={{ width: 200, height: 200 }}\r\n            type={Camera.Constants.Type.front}\r\n            ref={(ref) => {\r\n              // You can access the camera component's ref here if needed\r\n            }}\r\n          />\r\n        )}\r\n      </View>\r\n      <View>\r\n        {remoteStream && <Video source={{ uri: remoteStream.toURL() }} style={{ width: 200, height: 200 }} />}\r\n      </View>\r\n      {isCalling ? (\r\n        <Button title=\"Terminer l'appel\" onPress={endVideoCall} />\r\n      ) : (\r\n        <Button title=\"Appeler maintenant\" onPress={startVideoCall} />\r\n      )}\r\n    </View>\r\n  );\r\n};\r\n\r\nexport default AppointmentsScreen;\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}