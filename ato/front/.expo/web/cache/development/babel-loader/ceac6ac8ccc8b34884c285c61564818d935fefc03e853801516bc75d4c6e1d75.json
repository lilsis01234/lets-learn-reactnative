{"ast":null,"code":"import _asyncToGenerator from \"@babel/runtime/helpers/asyncToGenerator\";\nimport _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nimport React, { useEffect, useState } from 'react';\nimport View from \"react-native-web/dist/exports/View\";\nimport Text from \"react-native-web/dist/exports/Text\";\nimport Button from \"react-native-web/dist/exports/Button\";\nimport { RTCView, mediaDevices, RTCPeerConnection, RTCSessionDescription } from 'react-native-webrtc';\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nvar AppointmentsScreen = function AppointmentsScreen() {\n  var _ref;\n  var _useState = useState([]),\n    _useState2 = _slicedToArray(_useState, 2),\n    appointments = _useState2[0],\n    setAppointments = _useState2[1];\n  var _useState3 = useState(null),\n    _useState4 = _slicedToArray(_useState3, 2),\n    localStream = _useState4[0],\n    setLocalStream = _useState4[1];\n  var _useState5 = useState(null),\n    _useState6 = _slicedToArray(_useState5, 2),\n    remoteStream = _useState6[0],\n    setRemoteStream = _useState6[1];\n  var _useState7 = useState(null),\n    _useState8 = _slicedToArray(_useState7, 2),\n    peerConnection = _useState8[0],\n    setPeerConnection = _useState8[1];\n  var _useState9 = useState(null),\n    _useState10 = _slicedToArray(_useState9, 2),\n    selectedAppointment = _useState10[0],\n    setSelectedAppointment = _useState10[1];\n  useEffect(function () {}, []);\n  var isMeetingTime = function isMeetingTime(meetingDate, meetingStartTime) {\n    var rendezvousStartTime = new Date(meetingDate);\n    var _meetingStartTime$spl = meetingStartTime.split(':'),\n      _meetingStartTime$spl2 = _slicedToArray(_meetingStartTime$spl, 2),\n      hours = _meetingStartTime$spl2[0],\n      minutes = _meetingStartTime$spl2[1];\n    rendezvousStartTime.setHours(hours);\n    rendezvousStartTime.setMinutes(minutes);\n    var currentDate = new Date();\n    return currentDate >= rendezvousStartTime;\n  };\n  var initializeVideoCall = function initializeVideoCall() {\n    return (_ref = _ref || _asyncToGenerator(function* () {\n      try {\n        if (isMeetingTime(selectedAppointment.date, selectedAppointment.heureStart)) {\n          var pc = new RTCPeerConnection({\n            iceServers: []\n          });\n          var isFront = true;\n          var constraints = {\n            audio: true,\n            video: {\n              mandatory: {\n                minWidth: 500,\n                minHeight: 300,\n                minFrameRate: 30\n              },\n              facingMode: isFront ? 'user' : 'environment'\n            }\n          };\n          var stream = yield mediaDevices.getUserMedia(constraints);\n          stream.getTracks().forEach(function (track) {\n            pc.addTrack(track, stream);\n          });\n          pc.onicecandidate = function (event) {\n            if (event.candidate) {}\n          };\n          var offer = yield pc.createOffer();\n          yield pc.setLocalDescription(offer);\n          var remoteDesc = new RTCSessionDescription({\n            type: 'answer',\n            sdp: '...'\n          });\n          yield pc.setRemoteDescription(remoteDesc);\n          setPeerConnection(pc);\n        } else {\n          console.log('Attente de l\\'heure de début de la visioconférence...');\n        }\n      } catch (error) {\n        console.error('Erreur lors de la création de la visioconférence :', error);\n      }\n    })).apply(this, arguments);\n  };\n  var joinMeeting = function joinMeeting(appointment) {\n    setSelectedAppointment(appointment);\n    initializeVideoCall();\n  };\n  return _jsxs(View, {\n    children: [_jsx(Text, {\n      children: \"Mes rendez-vous approuv\\xE9s\"\n    }), appointments.map(function (appointment) {\n      return _jsxs(View, {\n        children: [_jsxs(Text, {\n          children: [\"Description : \", appointment.description]\n        }), _jsxs(Text, {\n          children: [\"Heure de d\\xE9but : \", appointment.heureStart]\n        }), isMeetingTime(appointment.date, appointment.heureStart) ? _jsx(Button, {\n          title: \"Rejoindre la visioconf\\xE9rence\",\n          onPress: function onPress() {\n            return joinMeeting(appointment);\n          }\n        }) : _jsx(Text, {\n          children: \"Attente de l'heure de d\\xE9but\"\n        })]\n      }, appointment._id);\n    }), localStream && _jsx(RTCView, {\n      streamURL: localStream.toURL(),\n      style: {\n        width: 200,\n        height: 200\n      }\n    }), remoteStream && _jsx(RTCView, {\n      streamURL: remoteStream.toURL(),\n      style: {\n        width: 200,\n        height: 200\n      }\n    })]\n  });\n};\nexport default AppointmentsScreen;","map":{"version":3,"names":["React","useEffect","useState","View","Text","Button","RTCView","mediaDevices","RTCPeerConnection","RTCSessionDescription","jsx","_jsx","jsxs","_jsxs","AppointmentsScreen","_ref","_useState","_useState2","_slicedToArray","appointments","setAppointments","_useState3","_useState4","localStream","setLocalStream","_useState5","_useState6","remoteStream","setRemoteStream","_useState7","_useState8","peerConnection","setPeerConnection","_useState9","_useState10","selectedAppointment","setSelectedAppointment","isMeetingTime","meetingDate","meetingStartTime","rendezvousStartTime","Date","_meetingStartTime$spl","split","_meetingStartTime$spl2","hours","minutes","setHours","setMinutes","currentDate","initializeVideoCall","_asyncToGenerator","date","heureStart","pc","iceServers","isFront","constraints","audio","video","mandatory","minWidth","minHeight","minFrameRate","facingMode","stream","getUserMedia","getTracks","forEach","track","addTrack","onicecandidate","event","candidate","offer","createOffer","setLocalDescription","remoteDesc","type","sdp","setRemoteDescription","console","log","error","apply","arguments","joinMeeting","appointment","children","map","description","title","onPress","_id","streamURL","toURL","style","width","height"],"sources":["C:/Users/Fabiola/Desktop/projet/front/components/VisioConference/VisioConference.jsx"],"sourcesContent":["import React, { useEffect, useState } from 'react';\r\nimport { View, Text, Button } from 'react-native';\r\nimport { RTCView, mediaDevices, RTCPeerConnection, RTCSessionDescription } from 'react-native-webrtc';\r\n\r\nconst AppointmentsScreen = () => {\r\n  const [appointments, setAppointments] = useState([]);\r\n  const [localStream, setLocalStream] = useState(null);\r\n  const [remoteStream, setRemoteStream] = useState(null);\r\n  const [peerConnection, setPeerConnection] = useState(null);\r\n  const [selectedAppointment, setSelectedAppointment] = useState(null);\r\n\r\n  useEffect(() => {\r\n    // Avy am localhost:3000/rendezvous/ny id avy ao am localStorage.getItem('id')\r\n  }, []);\r\n\r\n  const isMeetingTime = (meetingDate, meetingStartTime) => {\r\n    const rendezvousStartTime = new Date(meetingDate);\r\n    const [hours, minutes] = meetingStartTime.split(':');\r\n    rendezvousStartTime.setHours(hours);\r\n    rendezvousStartTime.setMinutes(minutes);\r\n\r\n    const currentDate = new Date();\r\n    return currentDate >= rendezvousStartTime;\r\n  };\r\n\r\n  const initializeVideoCall = async () => {\r\n    try {\r\n      // Assurez-vous que selectedAppointment contient le rendez-vous sélectionné\r\n\r\n      // Vérifiez les autorisations du docteur et du patient ici\r\n      // Vous pouvez faire une requête au backend pour vérifier les autorisations\r\n\r\n      // Vérifiez si la date et l'heure actuelles sont supérieures à la date et l'heure de début du rendez-vous\r\n      if (isMeetingTime(selectedAppointment.date, selectedAppointment.heureStart)) {\r\n        // Créez un peer connection\r\n        const pc = new RTCPeerConnection({ iceServers: [] });\r\n\r\n        // Obtenez le flux vidéo local\r\n        const isFront = true; // Utilisez la caméra frontale\r\n        const constraints = {\r\n          audio: true,\r\n          video: {\r\n            mandatory: {\r\n              minWidth: 500,\r\n              minHeight: 300,\r\n              minFrameRate: 30,\r\n            },\r\n            facingMode: isFront ? 'user' : 'environment',\r\n          },\r\n        };\r\n\r\n        const stream = await mediaDevices.getUserMedia(constraints);\r\n\r\n        // Ajoutez le flux vidéo local au peer connection\r\n        stream.getTracks().forEach((track) => {\r\n          pc.addTrack(track, stream);\r\n        });\r\n\r\n        // Gérez les événements de peer connection (ICE candidates, etc.)\r\n        pc.onicecandidate = (event) => {\r\n          if (event.candidate) {\r\n            // Envoyez l'ICE candidate au serveur\r\n          }\r\n        };\r\n\r\n        // Obtenez l'offre de peer connection\r\n        const offer = await pc.createOffer();\r\n        await pc.setLocalDescription(offer);\r\n\r\n        // Envoyez l'offre au serveur\r\n        // Attendez la réponse du serveur\r\n        // Mettez à jour la description distante du peer connection\r\n\r\n        // Créez une réponse RTCSessionDescription en utilisant la réponse du serveur\r\n        const remoteDesc = new RTCSessionDescription({ type: 'answer', sdp: '...' });\r\n        await pc.setRemoteDescription(remoteDesc);\r\n\r\n        // Mettez à jour la description distante du peer connection\r\n\r\n        // Le peer connection est maintenant établi et prêt à diffuser le flux vidéo\r\n        setPeerConnection(pc);\r\n      } else {\r\n        console.log('Attente de l\\'heure de début de la visioconférence...');\r\n      }\r\n    } catch (error) {\r\n      console.error('Erreur lors de la création de la visioconférence :', error);\r\n    }\r\n  };\r\n\r\n  const joinMeeting = (appointment) => {\r\n    // Sélectionnez le rendez-vous auquel vous souhaitez participer\r\n    setSelectedAppointment(appointment);\r\n\r\n    // Initialisez la visioconférence\r\n    initializeVideoCall();\r\n  };\r\n\r\n  return (\r\n    <View>\r\n      <Text>Mes rendez-vous approuvés</Text>\r\n      {appointments.map((appointment) => (\r\n        <View key={appointment._id}>\r\n          <Text>Description : {appointment.description}</Text>\r\n          <Text>Heure de début : {appointment.heureStart}</Text>\r\n          {isMeetingTime(appointment.date, appointment.heureStart) ? (\r\n            <Button title=\"Rejoindre la visioconférence\" onPress={() => joinMeeting(appointment)} />\r\n          ) : (\r\n            <Text>Attente de l'heure de début</Text>\r\n          )}\r\n        </View>\r\n      ))}\r\n      {localStream && <RTCView streamURL={localStream.toURL()} style={{ width: 200, height: 200 }} />}\r\n      {remoteStream && <RTCView streamURL={remoteStream.toURL()} style={{ width: 200, height: 200 }} />}\r\n    </View>\r\n  );\r\n};\r\n\r\nexport default AppointmentsScreen;\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}